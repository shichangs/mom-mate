# 回归测试清单

## 睡眠

1. 点击“记录入睡”后生成进行中记录。
2. 点击“记录醒来”后记录进入历史，时长正确，且该条记录身份保持不变（编辑/删除目标不漂移）。
3. “选择其他时间”可选择日期+时间补录，跨天记录展示正确。
4. 重复点击“记录入睡”不会创建多个进行中记录。
5. 编辑记录时，醒来时间不能早于入睡时间。
6. 历史记录列表与“最近记录”行样式一致（时长区、入睡/醒来时间线、日期标签一致）。
7. 睡眠页“选择其他时间”轮盘选择器按中文展示日期与时间。

## 饮食

1. 快速添加可保存记录并立即展示在列表。
2. “食物清单”可统一管理默认与自定义食物（新增、删除、拖拽排序）。
3. “添加饮食记录”中的“常用食物”与食物清单内容及顺序一致。
4. 删除记录后，列表与“今日饮食”摘要计数一致。
5. 餐次筛选结果正确。
6. 食物清单新增同名食材（仅大小写或前后空格不同）时不应重复创建。
7. 旧版本 `savedFoodList` 数据可自动迁移到新食物清单并保持顺序。
8. “添加饮食”中的时间选择器按中文展示日期与时间。

## 成长里程碑

1. 新增、编辑、删除可正常生效。
2. 列表按日期倒序展示。
3. 分类筛选与“全部”切换正确。
4. 新增/编辑里程碑时日期选择器按中文展示。

## 统计

1. 睡眠统计周/月/年切换正常，并支持周期前后翻页。
2. 跨夜睡眠记录归属到“醒来当天”。
3. 饮食统计图在有数据/无数据状态都正确显示。
4. 当前周期（如本周/本月/本年）时，“下一周期”按钮应禁用。
5. 统计页在周/月/年边界切换时不崩溃（无强制解包异常）。
6. 睡眠统计概览文案与口径一致：显示“日均睡眠时长 / 总睡眠时长 / 日均睡眠次数”。
7. 睡眠年视图展示“月日均睡眠时长”（按当月天数平均），不按“每条记录平均”计算。
8. 饮食统计概览文案一致：显示“总进食次数 / 日均进食次数 / 主要进食类型”。
9. 统计周期天数口径正确：月视图在 31 天月份与闰年 2 月（29 天）计算正确。

## 账号与同步

1. 未登录可直接进入主页面并正常新增/编辑/删除记录（游客模式）。
2. 设置页可进入“账号与同步”页面。
3. Debug 构建下点击“Debug Mock Apple 登录”后显示已登录状态。
4. 登录后重启 App 会话可恢复，退出登录后会话被清除但本机数据仍保留。
5. `cloudSyncEnabled = true` 且已登录时才触发云同步；未登录时不触发云同步。
6. 登录态恢复后 `syncAuthorized` 为 true；退出登录后 `syncAuthorized` 为 false，且会话数据被清理。

## Notes

1. 睡眠页右上角“开发者文档”入口可正常打开 Notes 页面。
2. Notes 页面支持进入编辑态并保存内容；关闭后再次进入内容不丢失。
3. 已登录且开启 iCloud 同步时，Notes 修改后重启应用仍保持同步后的最新内容。

## 文档

1. 功能行为改动已同步更新 `docs/product/PRD.md`。
2. 功能行为改动已同步更新 `docs/testing/REGRESSION_CHECKLIST.md`。
3. 技术方案改动已同步更新 `docs/architecture/*.md`。
4. PR 描述已注明对应文档与章节。
