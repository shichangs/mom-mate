# 回归测试清单

## 睡眠

1. 点击“记录入睡”后生成进行中记录。
2. 点击“记录醒来”后记录进入历史，时长正确，且该条记录身份保持不变（编辑/删除目标不漂移）。
3. “选择其他时间”可选择日期+时间补录，跨天记录展示正确。
4. 重复点击“记录入睡”不会创建多个进行中记录。
5. 编辑记录时，醒来时间不能早于入睡时间。
6. 历史记录列表与“最近记录”行样式一致（时长区、入睡/醒来时间线、日期标签一致）。
7. 睡眠页“选择其他时间”轮盘选择器按中文展示日期与时间。
8. 睡眠首页“最近记录”点击任意一条可进入编辑页，保存后列表与统计正确刷新。

## 饮食

1. 快速添加可保存记录并立即展示在列表。
2. “食物清单”可统一管理默认与自定义食物（新增、删除、拖拽排序）。
3. “添加饮食记录”中的“常用食物”与食物清单内容及顺序一致。
4. 删除记录后，列表与“今日饮食”摘要计数一致。
5. 餐次筛选结果正确。
6. 食物清单新增同名食材（仅大小写或前后空格不同）时不应重复创建。
7. 旧版本 `savedFoodList` 数据可自动迁移到新食物清单并保持顺序。
8. 选择“水”餐次时提供 50/100/200/500ml 快捷档位与“自定义”输入，保存后列表展示正确。
9. 今日饮食次数不包含饮水记录。
10. 今日饮水可设置目标（ml），进度条按“当日饮水总量 / 目标”正确显示。
11. “添加饮食”中的时间选择器按中文展示日期与时间。
12. 妈妈食谱入口显示有色卡片样式，且与上下模块间距保持紧凑一致。
13. 餐次筛选栏采用多列换行布局，默认可直接看到“水”“奶”等全部餐次（无需先横向滚动）。
14. 打开“添加饮食”时，默认餐次按当前时间自动预选：早餐（05:00-10:59）、午餐（11:00-16:59）、晚餐（其余时段）。

## 成长里程碑

1. 新增、编辑、删除可正常生效。
2. 列表按日期倒序展示。
3. 分类筛选与“全部”切换正确。
4. 新增/编辑里程碑时日期选择器按中文展示。

## 统计

1. 睡眠统计周/月/年切换正常，并支持周期前后翻页。
2. 跨夜睡眠记录归属到“醒来当天”。
3. 饮食统计图在有数据/无数据状态都正确显示。
4. 当前周期（如本周/本月/本年）时，“下一周期”按钮应禁用。
5. 统计页在周/月/年边界切换时不崩溃（无强制解包异常）。
6. 睡眠统计概览文案与口径一致：显示“日均睡眠时长 / 总睡眠时长 / 日均睡眠次数”。
7. 睡眠年视图展示“月日均睡眠时长”（按当月天数平均），不按“每条记录平均”计算。
8. 饮食统计概览文案一致：显示“总进食次数 / 日均进食次数 / 日均喝水量”。
9. 统计周期天数口径正确：月视图在 31 天月份与闰年 2 月（29 天）计算正确。
10. 饮食统计中的“每日喝水量（ml）”与记录值一致，日均喝水量计算正确。
11. 饮食统计中的“总进食次数 / 日均进食次数”不包含饮水记录。
12. 饮食统计中的“饮食类型分布”包含“水”分类，且数值与记录条数一致。
13. 饮食类型分布图例可读，能明确看到“水”及其次数。

## 账号与同步

1. 未登录可直接进入主页面并正常新增/编辑/删除记录（游客模式）。
2. 设置页可进入“账号与同步”页面。
3. Debug 构建下点击“Debug Mock Apple 登录”后显示已登录状态。
4. 登录后重启 App 会话可恢复，退出登录后会话被清除但本机数据仍保留。
5. `cloudSyncEnabled = true` 且已登录时才触发云同步；未登录时不触发云同步。
6. 登录态恢复后 `syncAuthorized` 为 true；退出登录后 `syncAuthorized` 为 false，且会话数据被清理。

## 设置

1. 点击“设置 > 清空数据”后，出现二次确认弹窗，并可勾选要清空的数据模块（睡眠/饮食/里程碑）。
2. 二次确认中的“确认清空”按钮在前 5 秒不可点击，倒计时结束后可点击。
3. 未勾选任何模块时，“确认清空”按钮保持不可点击，并提示至少选择一项数据。
4. 仅勾选部分模块并确认后，仅对应模块数据被清空，未勾选模块数据保留。
5. 设置页展示当前版本号，格式为 `v主版本.次版本.小版本 (构建号)`。
6. 设置页“本次更新”区域展示简洁变更信息，且内容与当前版本号对应。

## Notes

1. 用户态界面中不应出现“开发者文档/Notes”入口（含睡眠页右上角工具栏）。
2. 用户主流程（睡眠/饮食/成长/统计/设置）不依赖 Notes 页面。

## 文档

1. 功能行为改动已同步更新 `docs/product/PRD.md`。
2. 功能行为改动已同步更新 `docs/testing/REGRESSION_CHECKLIST.md`。
3. 技术方案改动已同步更新 `docs/architecture/*.md`。
4. PR 描述已注明对应文档与章节。
