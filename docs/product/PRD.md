# MomMate PRD（产品需求文档）

- 文档版本：v1.6
- 文档日期：2026-02-13
- 适用范围：`MomMate` iOS 项目（当前代码基线）
- 平台：iOS 17.0+

## 1. 产品概述

MomMate 是一款面向新手父母的婴儿成长记录工具，核心解决“记录零散、回顾困难、趋势不清晰”问题。  
当前版本通过睡眠、饮食、成长里程碑、统计、设置与账号同步等模块，帮助家长快速记录并获得基础统计洞察。

## 2. 背景与问题

- 家长在夜间或忙碌状态下，记录行为需要“低操作成本”。
- 宝宝成长数据分散在聊天、备忘录、纸笔中，难以形成连续时间线。
- 仅有记录不够，用户需要可视化统计来辅助判断作息与喂养规律。

## 3. 产品目标（R）

### 3.1 业务目标

- 建立一个可持续使用的日常记录工具，形成宝宝生活数据沉淀。
- 支持家长快速回顾近期行为，降低“记不清”的决策成本。

### 3.2 用户目标

- 10 秒内完成一次睡眠或饮食记录。
- 1 分钟内完成“今天发生了什么”的回顾。
- 能查看近 7 天的睡眠/饮食趋势变化。

### 3.3 成功指标（建议）

- D7 留存率 >= 25%
- 人均日记录次数 >= 3
- 睡眠记录完成率（开始后有结束）>= 80%
- 统计页周访问率 >= 40%

## 4. 用户与场景

### 4.1 目标用户

- 0-2 岁婴幼儿家长（主要为母亲，次要为共同照护者）
- 对记录有需求但不愿使用复杂母婴系统的用户

### 4.2 核心场景

- 夜间一键记录宝宝入睡/醒来
- 白天记录饮食类型与常吃食物
- 记录宝宝“第一次微笑/翻身/站立”等成长时刻
- 每天查看统计，判断是否存在明显异常

## 5. 功能需求（P）

### 5.0 当前实现状态快照（2026-02-13）

- 睡眠模块：已实现（开始/结束/补录/历史编辑删除/今日摘要）。
- 饮食模块：已实现（记录、筛选、删除、食物清单管理、旧数据迁移）。
- 成长里程碑：已实现（快捷添加、自定义新增、筛选、编辑、删除）。
- 统计模块：已实现（睡眠/饮食双模式，周/月/年周期，趋势图与分布图）。
- 设置与同步：已实现（字体缩放、iCloud 开关、登录态联动同步）。
- 第三方登录：部分实现（Apple 登录可用；Google/微信当前为入口占位与配置提示）。
- Notes 模块：代码能力已实现（Markdown 查看/编辑），当前未提供稳定的主流程入口。

### P0（必须）

1. 睡眠记录
- 一键开始睡眠、结束睡眠
- 支持“补录时间”（若干分钟前）
- 历史记录查看、编辑、删除
- 展示最近 5 条记录和完整历史列表

2. 饮食记录
- 快速新增饮食记录（餐次 + 食物）
- 按餐次筛选记录
- 今日饮食摘要（次数/分类）
- 支持删除记录

3. 成长里程碑
- 新增里程碑（日期、标题、分类、描述）
- 快捷添加常见里程碑
- 按分类筛选
- 编辑/删除里程碑

4. 统计分析
- 睡眠统计（周/月/年维度预览，支持周期翻页）
- 饮食统计（周/月/年频次、类型分布、摘要）
- 图形化展示（柱状/环形）

5. 基础设置
- 全局字体缩放（0.8x-1.5x）
- iCloud 数据同步开关（开启后优先同步云端数据）

6. 第三方登录
- 支持 Apple 登录
- 支持 Google 登录入口（需配置平台参数后可用）
- 支持微信登录入口（需配置平台参数后可用）
- 未登录用户可继续使用主功能（游客模式）
- 登录用于数据同步和备份能力
- 支持退出登录且不清除本机数据

### P1（应该有）

1. 常用食物管理（食物清单）
- 在“食物清单”统一管理默认食物与自定义食物
- 支持新增、删除（含默认食物）、拖拽排序
- 食材名称去重（忽略前后空格与大小写）
- 添加饮食记录时按食物清单顺序展示“常用食物”

2. 内置文档/笔记模块
- 查看与编辑 Markdown 文档（当前代码存在模块，主流程入口待稳定化）

### P2（可选优化）

1. 数据导出（CSV/分享）
2. 多宝宝档案切换
3. 记录提醒（本地通知）

## 6. 交互与体验要求

- 首页采用 Tab 结构：睡眠、饮食、统计、成长。
- 重点操作（新增/开始/结束）需在首屏可见。
- 空状态需提供明确引导文案。
- 动画与视觉语言统一（渐变、玻璃卡片、状态反馈）。
- 字体缩放后需保证核心页面不遮挡、不截断主要操作按钮。
- 应用图标需保持母婴主题视觉一致性，提供 `1024x1024` 主图资源并在 `Assets.xcassets/AppIcon.appiconset` 维护单一基线文件。

## 7. 数据与技术要求

### 7.1 数据对象

- SleepRecord：入睡时间、醒来时间、时长
- MealRecord：时间、餐次、食物、食量、备注
- Milestone：日期、标题、描述、分类
- FoodItem：食材 ID、名称、排序、归档状态（用于食物清单管理）

### 7.2 持久化

- 当前版本：`UserDefaults + JSON`（单一数据源）
- 同步能力：可选 `iCloud KVS (NSUbiquitousKeyValueStore)` 同步，受设置页开关控制
- 演进目标：在后续版本评估迁移到 `SwiftData`（分阶段迁移并可回滚）

### 7.3 性能

- 常规列表页面首屏渲染 <= 1s（中端机）
- 统计计算在 1000 条记录量级下可接受（无明显卡顿）
- 统计与摘要查询应优先使用 Manager 聚合缓存（按天桶/分类桶），避免视图层重复全量过滤

## 8. 非功能需求

- 稳定性：核心记录链路（新增/更新/删除）不可崩溃
- 可用性：离线可用，本地可读写
- 隐私：默认仅本地存储，不上传第三方服务
- 可维护性：核心业务逻辑集中在 Manager 层，便于后续迁移存储方案

## 9. 验收标准（UAT）

1. 睡眠
- 可开始并结束一条睡眠记录，时长显示正确
- 可通过“选择其他时间”补录，并正确进入历史
- 历史记录可编辑时间并保存生效

2. 饮食
- 可新增一条饮食记录并在列表立即可见
- 餐次筛选后列表结果正确
- 今日摘要中的次数与列表数据一致

3. 里程碑
- 可新增/编辑/删除里程碑
- 分类筛选正确，时间线顺序正确（新到旧）

4. 统计
- 睡眠统计在不同周期切换时数据变化正确
- 饮食统计图表能在有/无数据两种状态下正常显示
- 统计周期包含周/月/年，且未来周期不可继续前进

5. 设置
- 字体缩放调整后，四个主 Tab 页面文字同步变化

6. 第三方登录
- 未登录用户打开 App 时可直接进入主功能页（游客模式）
- 可在设置页入口触发 Apple 登录并开启同步
- Google/微信入口可见，未配置平台参数时需给出明确提示
- 登录后可退出，退出后仍可继续本机使用

## 10. 风险与待决策项

- 当前 `UserDefaults` 在数据量增长后存在性能与可维护性风险。
- SwiftData 相关模型已保留为后续迁移候选，需避免恢复双数据源并存。
- 测试数据自动生成仅限 Debug 环境，发布版禁止自动注入测试数据。

## 11. 版本规划建议

### V1.0（当前能力收敛）

- 完成三大记录模块 + 统计 + 设置
- 修正边界问题并补齐基础测试用例

### V1.1（体验增强）

- 自定义食物联动到快速添加面板
- 增加本地通知提醒
- 优化统计性能与图表可读性
- 建立基础 CI 构建门禁与发布回归清单

### V1.2（数据升级）

- 迁移到 SwiftData 单一存储
- 引入可控的 iCloud 同步策略
- 提供数据导出与备份能力

## 12. 指标定义与埋点方案

### 12.1 指标口径定义

- D7 留存率：`安装后第 7 天仍至少打开 1 次 App 的用户数 / 第 0 天新增用户数`
- 人均日记录次数：`当日总记录数（睡眠+饮食+里程碑） / 当日活跃用户数`
- 睡眠记录完成率：`已结束睡眠记录数 / 已开始睡眠记录数`
- 统计页周访问率：`最近 7 天内至少访问过 1 次统计页的用户数 / 最近 7 天活跃用户数`

### 12.2 埋点事件（建议）

- `app_opened`
- `sleep_start_clicked`
- `sleep_end_clicked`
- `sleep_record_saved`
- `sleep_record_edited`
- `sleep_record_deleted`
- `meal_record_saved`
- `meal_record_deleted`
- `milestone_saved`
- `milestone_edited`
- `milestone_deleted`
- `statistics_tab_viewed`
- `settings_font_scale_changed`

### 12.3 关键事件属性（建议）

- 通用：`timestamp`、`app_version`、`os_version`
- 睡眠：`is_backfill`、`duration_minutes`、`record_date`
- 饮食：`meal_type`、`food_count`
- 里程碑：`category`
- 统计：`statistics_mode`（sleep/meal）

## 13. 边界条件与异常处理

### 13.1 睡眠记录

- 入睡/醒来时间不得晚于当前时间。
- 醒来时间必须晚于入睡时间；若不满足则提示并阻止保存。
- 若存在进行中的睡眠记录，不允许再次“开始睡眠”创建重复进行中记录。
- 补录跨天场景应正常显示在对应日期，不得丢失。

### 13.2 饮食记录

- 餐次为必填，食物可为空。
- 删除后列表与今日摘要需同步刷新，数量口径保持一致。
- 时间筛选按本地时区自然日计算（00:00-23:59）。
- 食物清单支持统一管理默认与自定义食物，删除与排序后应立即影响“添加饮食记录”的常用食物展示。
- 食物清单对同名食材（忽略大小写与空白）不重复新增。

### 13.3 里程碑记录

- 标题为必填，描述可为空。
- 列表排序规则固定为“日期倒序（新到旧）”。
- 分类筛选需支持“全部”和单分类切换，不得出现混合状态。

### 13.4 统计模块

- 无数据时必须展示空状态，不显示错误图形。
- 统计仅使用有效记录（睡眠需 `wakeTime != nil`）。
- 统计周期切换后应在 1 秒内完成可视反馈。

## 14. 数据迁移与回滚方案

### 14.1 目标

- 从 `UserDefaults + JSON` 平滑迁移到 `SwiftData` 单一数据源。
- 迁移过程不丢数据，可观测，可回滚。

### 14.2 迁移步骤

1. 应用启动检测迁移标记 `data_migration_v1_done`。
2. 若未迁移：读取 `SleepRecords`、`MealRecords`、`Milestones`。
3. 写入 SwiftData 并做条数校验（源条数 = 目标条数）。
4. 校验通过后写入迁移标记，后续只读 SwiftData。
5. 保留旧数据 1 个版本周期后再清理。

### 14.3 失败处理

- 任一步骤失败：维持旧存储为主，不写迁移完成标记。
- 上报迁移失败事件 `data_migration_failed`（包含错误码）。
- 下次启动重试迁移；连续失败超过阈值后停止自动重试并提示用户备份。

### 14.4 回滚策略

- 若新版本发现严重数据异常，回滚到“旧存储读取优先”策略。
- 回滚后保留 SwiftData 数据，不做删除，供后续修复比对。

## 15. 发布准入标准（Release Gate）

### 15.1 功能准入

- P0 功能全部通过 UAT。
- 边界用例通过率 100%（以第 13 章为准）。
- 不允许存在 P0 级阻断缺陷（Crash / 数据错乱 / 数据丢失）。

### 15.2 质量准入

- 核心路径（睡眠记录、饮食记录、里程碑记录、统计查看）手测通过率 100%。
- 本地持久化重启后数据一致性通过。
- 首屏可交互时间（中端机）<= 1 秒。

### 15.3 文档准入

- 本次改动涉及产品行为变化时，`docs/product/PRD.md` 必须同步更新。
- PR 描述中必须明确“PRD 更新章节”。
- 未满足文档准入的 PR 不允许合并。
